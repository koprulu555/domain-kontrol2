name: 'BaseURL GÃ¼ncelleyici'
on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Repoyu Ã‡ek
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          # BU SATIR Ã‡OK Ã–NEMLÄ°: Repoyu tam olarak Ã§ek
          fetch-depth: 0

      - name: ğŸ Python Kur
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ requests YÃ¼kle
        run: pip install requests

      - name: ğŸ¯ BaseURL Ã‡ek
        run: |
          echo "=== Python Script Ã‡alÄ±ÅŸtÄ±rÄ±lÄ±yor ==="
          python3 fetch_baseurl.py
          
          # DosyanÄ±n oluÅŸup oluÅŸmadÄ±ÄŸÄ±nÄ± kontrol et
          echo "=== Dosya KontrolÃ¼ ==="
          ls -la guncel_baseurl.txt 2>/dev/null || echo "DOSYA BULUNAMADI!"
          cat guncel_baseurl.txt 2>/dev/null || echo "DOSYA OKUNAMADI!"

      - name: ğŸ“ DeÄŸiÅŸiklikleri Kaydet
        if: always()
        run: |
          echo "=== Git Ä°ÅŸlemleri ==="
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # Hangi dosyalarÄ±n deÄŸiÅŸtiÄŸini gÃ¶ster
          git status
          
          # guncel_baseurl.txt dosyasÄ±nÄ± kontrol et
          if [ -f "guncel_baseurl.txt" ]; then
            echo "âœ… guncel_baseurl.txt DOSYASI VAR"
            echo "ğŸ“„ Ä°Ã§erik:"
            cat guncel_baseurl.txt
            
            # DosyayÄ± ekle
            git add guncel_baseurl.txt
            
            # DeÄŸiÅŸikliÄŸi commit et
            if ! git diff --cached --quiet; then
              git commit -m "ğŸ”— BaseURL gÃ¼ncellendi: $(date '+%Y-%m-%d %H:%M')"
              echo "âœ… Commit yapÄ±ldÄ±"
              
              # Push et
              git push
              echo "âœ… Push edildi"
            else
              echo "â„¹ï¸  DeÄŸiÅŸiklik yok, commit atÄ±lmadÄ±"
            fi
          else
            echo "âŒ HATA: guncel_baseurl.txt DOSYASI OLUÅMAMIÅ!"
            echo "Mevcut dosyalar:"
            ls -la
          fi
